<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/72f5ad9b03c55da9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9edee2920554d0a5.js"/><script src="/_next/static/chunks/4bd1b696-16d666f9e71e87fe.js" async=""></script><script src="/_next/static/chunks/684-f45ebf7c234f6da9.js" async=""></script><script src="/_next/static/chunks/main-app-b422431e092c98bc.js" async=""></script><script src="/_next/static/chunks/874-631f971718a34eb1.js" async=""></script><script src="/_next/static/chunks/app/layout-84c1f7e87b2657ad.js" async=""></script><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2657417531473772" crossorigin="anonymous"></script><script src="/_next/static/chunks/63-5806933bdf8df935.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bid%5D/page-9a7fa6f3b29855f0.js" async=""></script><title>Comstering&#x27;s Dev Notes</title><meta name="description" content="Comstering&#x27;s personal development blog"/><meta name="keywords" content="Comstering, 개발 블로그, Dev Notes, Programming, Software Development"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="1024x1024"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="min-h-screen flex flex-col font-sans transition-colors duration-500 ease-in-out bg-slate-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100"><div class="fixed inset-0 overflow-hidden pointer-events-none -z-10"><div class="absolute -top-40 -left-40 w-80 h-80 bg-sky-500/10 dark:bg-sky-500/5 rounded-full blur-[100px]"></div><div class="absolute top-1/2 -right-40 w-96 h-96 bg-indigo-500/10 dark:bg-indigo-500/5 rounded-full blur-[120px]"></div></div><header class="sticky top-0 z-[60] bg-white/70 dark:bg-gray-950/70 backdrop-blur-xl border-b border-gray-100 dark:border-gray-900"><div class="container mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-20"><div class="flex-shrink-0"><a class="group flex items-center gap-2" href="/"><div class="w-10 h-10 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-black shadow-lg shadow-sky-500/20 group-hover:rotate-12 transition-transform">D</div><span class="text-2xl font-black text-gray-900 dark:text-white tracking-tighter">Dev<span class="text-sky-500">Notes</span></span></a></div><nav class="hidden md:flex items-center space-x-10"><a class="text-gray-500 dark:text-gray-400 hover:text-sky-500 dark:hover:text-sky-400 transition-all font-bold" href="/">HOME</a><a class="text-gray-500 dark:text-gray-400 hover:text-sky-500 dark:hover:text-sky-400 transition-all font-bold" href="/about">ABOUT</a><div class="h-6 w-[1px] bg-gray-200 dark:bg-gray-800 mx-2"></div><div class="w-6 h-6"></div></nav><div class="md:hidden"><div class="w-6 h-6"></div></div></div></div></header><main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10"><article class="max-w-3xl mx-auto"><header class="mb-12 space-y-8"><div class="flex justify-center"><a class="text-xs font-bold text-sky-500 flex items-center hover:gap-2 transition-all" href="/"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>BACK TO BLOG</a></div><div class="text-center space-y-4"><h1 class="text-4xl md:text-5xl font-black text-gray-900 dark:text-white leading-tight">Cilium CNI 알아보기</h1><div class="flex items-center justify-center gap-4 text-sm text-gray-500 font-medium"><span>2025-08-31</span><span class="w-1 h-1 bg-gray-300 rounded-full"></span><span>6 min read</span></div></div><div class="rounded-3xl overflow-hidden shadow-2xl shadow-sky-500/10 border border-gray-200 dark:border-gray-800 aspect-[21/9]"><img alt="Cilium CNI 알아보기" loading="lazy" width="840" height="360" decoding="async" data-nimg="1" class="w-full h-full object-cover" style="color:transparent" src="/images/posts/thumbnails/cilium.png"/></div></header><div class="prose prose-lg dark:prose-invert max-w-none"><div><h2>What is Cilium CNI?</h2>
<h3>What is CNI?</h3>
<p>나는 Kubernetes를 EKS로 운영하고 있다. EKS에서는 CNI를 VPC CNI로 제공한다.</p>
<p>CNI란 Cloud Networking Interface의 약자로 k8s와 같은 Container Orchestration System에서 컨테이너 네트워킹을 구성하는 표준 인터페이스이다.</p>
<p>EKS에서 VPC CNI를 이미 제공해주고 있고 잘 사용하고 있는데 왜 갑자기 Cilium CNI를 알아보고 있을까?</p>
<h3>Cilium CNI</h3>
<p>Cilium CNI는 CNI 오픈소스 중 하나이다. Cilium CNI의 가장 대표적 특징은 eBPF라는 리눅스 커널 기술을 통해서 Networking을 구성한다는 것이다.</p>
<h3>VPC CNI vs Cilium CNI</h3>
<p>VPC CNI와 Cilium CNI의 가장 큰 차이점은 Networking 방식이다. VPC CNI는 iptables라는 기술을 통해서 Networking을 제어하고 Cilium CNI는 eBPF 기술을 통해서 Networking을 제어한다.</p>
<p>Networking 제어에는 k8s의 Service Network, <a href="https://kubernetes.io/ko/docs/concepts/services-networking/network-policies/" rel="nofollow" target="_blank">NetworkPolicy</a>에 대한 방식이 iptables를 이용하느냐 eBPF를 이용하느냐의 차이를 포함한다.</p>
<h4>kube-proxy</h4>
<p>k8s에서 Networking을 Pod &#x3C;-> Pod형태로 직접하지 않는다. Service라는 Resource를 이용해서 통신한다. Service에서 트래픽을 받으면 Service에 연결된 Pod에 적절히 라우팅을 해준다. 이 라우팅에 대한 iptables의 정보를 kube-proxy가 업데이트해준다.</p>
<h4>Network Policy</h4>
<p>Network policy는 Container Networking에서 각 컨테이너별 네트워크 정책을 설정하여 네트워크 보안관리를 하는 Resource다. NetworkPolicy에는 각 Network Layer별로 설정할 수 있으며 L3/L4부터 L7까지 정책 설정이 가능하다.</p>
<h4>iptables vs. eBPf</h4>
<p><img src="/images/posts/contents/introduce-cilium-cni/compare-networking.png" alt="compare-networking"></p>
<p>이 그림은 VPC CNI에서 사용하는 iptables 방식과 Cilium CNI의 eBPF의 차이를 잘 보여준다.</p>
<p>iptables의 networking을 보면 검사하는 단계가 매우 많다. 특히, iptables의 routing은 Service와 Pod가 늘어나면 늘어날 수록 늘어난다. iptables에 등록된 라우팅을 전체 검사하는 O(N)의 시간복잡도를 가지게 된다. 여기에 NetworkPolicy에 해당하는 규칙 검사까지 진행하게 되면 Network 속도는 더 느려질 수 밖에 없다.</p>
<p>kube-proxy 역시 이런 iptables의 규칙을 업데이트하는 형태로 Service, Pod의 Routing 및 Load Balancing을 진행한다.</p>
<p><img src="/images/posts/contents/introduce-cilium-cni/eBPF-linux-kernal.png" alt="eBPF-linux-kernal"></p>
<p>eBPF는 완전히 Linux Kernel 내장되어 있으며 eBPF Maps를 사용한다. 이 Maps는 말 그대로 Map 자료형을 생각하면 된다. Map 자료형은 Key, Value 형태로 구성되어 있으며 O(1)의 시간복잡도를 가진다. O(N)의 시간복잡도를 가지는 iptables와 비교해서 Service, Pod의 개수, NetworkPolicy 개수가 늘어나도 Network 속도가 기하급수적으로 늘어나지는 않는다.</p>
<p>또한 iptables를 사용하지 않기 때문에 iptables를 update하는 kube-proxy를 사용하지 않고 Cilium 자체에서 Routing과 LoadBalancing을 담당할 수 있다.
<a href="https://docs.cilium.io/en/stable/overview/intro/#load-balancing" rel="nofollow" target="_blank">https://docs.cilium.io/en/stable/overview/intro/#load-balancing</a></p>
<h4>Network Latency</h4>
<p><img src="/images/posts/contents/introduce-cilium-cni/compare-latency-service.png" alt="compare-latency-service"></p>
<p>eBPF와 kube-proxy의 Service 개수에 따른 Network Latency이다. 개수가 적을 때는 큰 차이를 보이지 않고 오히려 kube-proxy가 더 빠를 수도 있지만 서비스의 개수가 늘어나면 늘어날 수록 kube-proxy의 latency는 증가하는 반면 eBPF는 거의 동일한 결과를 보여주고 있다.</p>
<h4>Cilium Feature</h4>
<p>Cilium CNI를 고려한 가장 큰 이유는 Networking 방식인 iptables vs. eBPF의 차이로 인해 고려 중이었다. 또한 Cilium의 다양한 기능들도 이유에 포함되었다.</p>
<ul>
<li>Overlay Networking: 캡슐화 기반 가상 네트워크</li>
<li>Network monitoring: Hubble을 통해서 네트워크 모니터링 가능</li>
<li>Multi Cluster(Cluster Mesh): 하나의 k8s Cluster 내의 네트워크만이 아니라 Multi cluster간의 네트워크 통신을 손쉽게 관리할 수 있게 해준다.</li>
<li>IPAM: Cilium이 직접 Pod의 IP 할당을 담당하여 VPC 및 Subnet의 IP 부족 문제를 해결할 수 있다. -> 이건 이전 포스팅의 <a href="https://comstering.github.io/posts/eks-custom-networking" rel="nofollow" target="_blank">EKS Custom Networking</a>이 있어서 큰 메리트는 없었다.</li>
</ul>
<h2>How to set Cilium in EKS?</h2>
<p>Cilium CNI를 적용하겠다라고 의사결정을 한 이후 가장 큰 문제점은 EKS에 어떻게 적용하는 가였다. EKS에서는 이미 VPC CNI가 기본 설정이고 이 VPC CNI를 제거하는 순간 EKS내의 네트워크는 전부 마비가 된다. 또한 VPC CNI의 가장 큰 장점인 Pod의 IP가 VPC CIDR 내의 IP로 할당되어 AWS Resource와 direct 통신을 할 수 있는 장점도 없어지게 된다.</p>
<h3>Support Cilium</h3>
<p><img src="/images/posts/contents/introduce-cilium-cni/eks-alternate-cni.png" alt="eks-alternate-cni"></p>
<p>AWS <a href="https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/alternate-cni-plugins.html" rel="nofollow" target="_blank">EKS 문서</a>에서 VPC CNI외에 사용할 수 있는 CNI가 명시되어 있다. 여기에는 Cilium이 포함되어 있다.</p>
<p>이 문서대로라면 EKS의 VPC CNI를 대체제로 Cilium CNI를 사용할 수 있다는 뜻이 된다.</p>
<h3>Cilium CNI Chaining</h3>
<p>Cilium CNI와 VPC CNI의 차이가 있고 당연히 VPC CNI가 가지고 있는 장점이 있다. 이러한 장점을 전부 버리면서 Cilium으로 넘어가야하는지는 물음표였다. 특히 VPC CNI의 Pod ENI IP 할당을 VPC CIDR Block으로 할당하여 VPC의 라우팅 테이블을 그대로 사용하면 LoadBalancer &#x3C;-> Pod와의 통신이 Node를 거치지 않고 Direct로 된다는 점, 당연하게 RDS, MSK 등 VPC 내에 설치된 인스턴스들과 Node를 거치지 않고 Pod IP에서 direct도 통신한다는 점에서 Cilium을 사용하는 네트워크 통신보다 더 빠른 Network Latency를 가질 것 같았다.</p>
<p>그러던 중 Cilium CNI 문서에서 <a href="https://docs.cilium.io/en/stable/installation/cni-chaining/" rel="nofollow" target="_blank">CNI Chaining</a>이라는 문서를 확인했다. <a href="https://docs.cilium.io/en/stable/installation/cni-chaining-aws-cni/" rel="nofollow" target="_blank">AWS VPC CNI plugin 문서</a>에서 VPC CNi와 Cilium CNI가 함께 사용하는 내용을 보여주었다.</p>
<p><img src="/images/posts/contents/introduce-cilium-cni/aws-cni-chaining-1.png" alt="aws-cni-chaining-1">
<img src="/images/posts/contents/introduce-cilium-cni/aws-cni-chaining-2.png" alt="aws-cni-chaining-2"></p>
<p>두 이미지는 AWS VPC CNI와 Cilium을 Chaining 했을 때 각 CNI가 어떤 역할을 담당하는지 설명해주고 있다.</p>
<p>이것을 토대로 내 VPC에서 EKS Custom Networking을 적용한 Networking을 도식화하면 아래와 같은 결과가 나온다.</p>
<p><img src="/images/posts/contents/introduce-cilium-cni/networking-structure.png" alt="networking-structure"></p>
<p>VPC CNI는 IPAM을 담당하여 Pod의 IP를 EKS Custom Networking 대역으로 할당한다.</p>
<p>VPC 외부로 통신하는 TGW, NAT Gateway로 통신할 때는 masquerade SNAT가 되어 Pod IP는 Node IP로 변환되어 통신한다.</p>
<p>외부에서 트래픽을 받을 때는 NLB 통해서 통신하게 되는데 이때 NLB와 Pod간 통신은 VPC CNI의 라우팅을 통해서 Node를 거치지 않고 Direct로 Pod와 통신하게 된다. 마찬가지로 Pod가 내부에 배포되어 있는 RDS, MSK 등과 통신하게 될 때는 Node IP를 통하지 않고 direct로 Pod IP와 통신하게 된다.</p>
<p>나머지 Kubernetes Networking은 전부 Cilium CNI가 담당하여 LoadBalancing, Security 등을 처리한다.</p>
<h2>Finished</h2>
<p>Cilium CNI에 대해서 간단히 알아보고 내 EKS에 VPC CNI와 어떻게 잘 연결하여 사용할 수 있을지 알아보았다. 다음 포스팅에서는 위 내용을 토대로 내 EKS에 Cilium CNI를 설치하는 과정을 포스팅해보겠다.</p></div></div><div class="mt-16 pt-8 border-t border-card border-gray-100 dark:border-gray-800"><h2 class="text-2xl font-bold text-foreground mb-6">Comments</h2><div class="giscus-container mt-16"></div></div><footer class="mt-20 pt-10 border-t border-gray-100 dark:border-gray-800 flex flex-col items-center gap-8"><div class="flex items-center gap-4 p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 w-full"><img alt="Author" loading="lazy" width="64" height="64" decoding="async" data-nimg="1" class="w-16 h-16 rounded-full object-cover border-2 border-sky-400" style="color:transparent" src="/profile.png"/><div><h4 class="font-bold text-gray-900 dark:text-white">Written by Comstering</h4><p class="text-sm text-gray-500">개발과 운영의 경계를 좁히는 클라우드 네이티브 엔지니어입니다.</p></div></div><a class="font-bold text-gray-900 dark:text-white hover:text-sky-500 transition-colors" href="/">모든 글 보기 →</a></footer></article></main><footer class="bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-sm"><p>© <!-- -->2026<!-- --> Dev Notes. All rights reserved.</p></div></footer><script src="/_next/static/chunks/webpack-9edee2920554d0a5.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7049,[\"874\",\"static/chunks/874-631f971718a34eb1.js\",\"177\",\"static/chunks/app/layout-84c1f7e87b2657ad.js\"],\"ThemeProvider\"]\n3:I[6367,[\"874\",\"static/chunks/874-631f971718a34eb1.js\",\"177\",\"static/chunks/app/layout-84c1f7e87b2657ad.js\"],\"Header\"]\n4:I[7555,[],\"\"]\n5:I[1295,[],\"\"]\n7:I[9665,[],\"OutletBoundary\"]\na:I[9665,[],\"ViewportBoundary\"]\nc:I[9665,[],\"MetadataBoundary\"]\ne:I[6614,[],\"\"]\n:HL[\"/_next/static/css/72f5ad9b03c55da9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"_WOP8dx8iN-hIvgqBVo8E\",\"p\":\"\",\"c\":[\"\",\"posts\",\"introduce-cilium-cni\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"introduce-cilium-cni\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/72f5ad9b03c55da9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2657417531473772\",\"crossOrigin\":\"anonymous\"}]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col font-sans transition-colors duration-500 ease-in-out bg-slate-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100\",\"children\":[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"fixed inset-0 overflow-hidden pointer-events-none -z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute -top-40 -left-40 w-80 h-80 bg-sky-500/10 dark:bg-sky-500/5 rounded-full blur-[100px]\"}],[\"$\",\"div\",null,{\"className\":\"absolute top-1/2 -right-40 w-96 h-96 bg-indigo-500/10 dark:bg-indigo-500/5 rounded-full blur-[120px]\"}]]}],[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-sm\",\"children\":[\"$\",\"p\",null,{\"children\":[\"© \",2026,\" Dev Notes. All rights reserved.\"]}]}]}]]}]}]]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"introduce-cilium-cni\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",\"$undefined\",null,[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",null]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"3VomiELesHaFiPLEhMTFB\",{\"children\":[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}],[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[6874,[\"874\",\"static/chunks/874-631f971718a34eb1.js\",\"63\",\"static/chunks/63-5806933bdf8df935.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-9a7fa6f3b29855f0.js\"],\"\"]\n10:I[3063,[\"874\",\"static/chunks/874-631f971718a34eb1.js\",\"63\",\"static/chunks/63-5806933bdf8df935.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-9a7fa6f3b29855f0.js\"],\"Image\"]\n12:I[7161,[\"874\",\"static/chunks/874-631f971718a34eb1.js\",\"63\",\"static/chunks/63-5806933bdf8df935.js\",\"880\",\"static/chunks/app/posts/%5Bid%5D/page-9a7fa6f3b29855f0.js\"],\"default\"]\n11:T21c3,"])</script><script>self.__next_f.push([1,"\u003ch2\u003eWhat is Cilium CNI?\u003c/h2\u003e\n\u003ch3\u003eWhat is CNI?\u003c/h3\u003e\n\u003cp\u003e나는 Kubernetes를 EKS로 운영하고 있다. EKS에서는 CNI를 VPC CNI로 제공한다.\u003c/p\u003e\n\u003cp\u003eCNI란 Cloud Networking Interface의 약자로 k8s와 같은 Container Orchestration System에서 컨테이너 네트워킹을 구성하는 표준 인터페이스이다.\u003c/p\u003e\n\u003cp\u003eEKS에서 VPC CNI를 이미 제공해주고 있고 잘 사용하고 있는데 왜 갑자기 Cilium CNI를 알아보고 있을까?\u003c/p\u003e\n\u003ch3\u003eCilium CNI\u003c/h3\u003e\n\u003cp\u003eCilium CNI는 CNI 오픈소스 중 하나이다. Cilium CNI의 가장 대표적 특징은 eBPF라는 리눅스 커널 기술을 통해서 Networking을 구성한다는 것이다.\u003c/p\u003e\n\u003ch3\u003eVPC CNI vs Cilium CNI\u003c/h3\u003e\n\u003cp\u003eVPC CNI와 Cilium CNI의 가장 큰 차이점은 Networking 방식이다. VPC CNI는 iptables라는 기술을 통해서 Networking을 제어하고 Cilium CNI는 eBPF 기술을 통해서 Networking을 제어한다.\u003c/p\u003e\n\u003cp\u003eNetworking 제어에는 k8s의 Service Network, \u003ca href=\"https://kubernetes.io/ko/docs/concepts/services-networking/network-policies/\" rel=\"nofollow\" target=\"_blank\"\u003eNetworkPolicy\u003c/a\u003e에 대한 방식이 iptables를 이용하느냐 eBPF를 이용하느냐의 차이를 포함한다.\u003c/p\u003e\n\u003ch4\u003ekube-proxy\u003c/h4\u003e\n\u003cp\u003ek8s에서 Networking을 Pod \u0026#x3C;-\u003e Pod형태로 직접하지 않는다. Service라는 Resource를 이용해서 통신한다. Service에서 트래픽을 받으면 Service에 연결된 Pod에 적절히 라우팅을 해준다. 이 라우팅에 대한 iptables의 정보를 kube-proxy가 업데이트해준다.\u003c/p\u003e\n\u003ch4\u003eNetwork Policy\u003c/h4\u003e\n\u003cp\u003eNetwork policy는 Container Networking에서 각 컨테이너별 네트워크 정책을 설정하여 네트워크 보안관리를 하는 Resource다. NetworkPolicy에는 각 Network Layer별로 설정할 수 있으며 L3/L4부터 L7까지 정책 설정이 가능하다.\u003c/p\u003e\n\u003ch4\u003eiptables vs. eBPf\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/compare-networking.png\" alt=\"compare-networking\"\u003e\u003c/p\u003e\n\u003cp\u003e이 그림은 VPC CNI에서 사용하는 iptables 방식과 Cilium CNI의 eBPF의 차이를 잘 보여준다.\u003c/p\u003e\n\u003cp\u003eiptables의 networking을 보면 검사하는 단계가 매우 많다. 특히, iptables의 routing은 Service와 Pod가 늘어나면 늘어날 수록 늘어난다. iptables에 등록된 라우팅을 전체 검사하는 O(N)의 시간복잡도를 가지게 된다. 여기에 NetworkPolicy에 해당하는 규칙 검사까지 진행하게 되면 Network 속도는 더 느려질 수 밖에 없다.\u003c/p\u003e\n\u003cp\u003ekube-proxy 역시 이런 iptables의 규칙을 업데이트하는 형태로 Service, Pod의 Routing 및 Load Balancing을 진행한다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/eBPF-linux-kernal.png\" alt=\"eBPF-linux-kernal\"\u003e\u003c/p\u003e\n\u003cp\u003eeBPF는 완전히 Linux Kernel 내장되어 있으며 eBPF Maps를 사용한다. 이 Maps는 말 그대로 Map 자료형을 생각하면 된다. Map 자료형은 Key, Value 형태로 구성되어 있으며 O(1)의 시간복잡도를 가진다. O(N)의 시간복잡도를 가지는 iptables와 비교해서 Service, Pod의 개수, NetworkPolicy 개수가 늘어나도 Network 속도가 기하급수적으로 늘어나지는 않는다.\u003c/p\u003e\n\u003cp\u003e또한 iptables를 사용하지 않기 때문에 iptables를 update하는 kube-proxy를 사용하지 않고 Cilium 자체에서 Routing과 LoadBalancing을 담당할 수 있다.\n\u003ca href=\"https://docs.cilium.io/en/stable/overview/intro/#load-balancing\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://docs.cilium.io/en/stable/overview/intro/#load-balancing\u003c/a\u003e\u003c/p\u003e\n\u003ch4\u003eNetwork Latency\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/compare-latency-service.png\" alt=\"compare-latency-service\"\u003e\u003c/p\u003e\n\u003cp\u003eeBPF와 kube-proxy의 Service 개수에 따른 Network Latency이다. 개수가 적을 때는 큰 차이를 보이지 않고 오히려 kube-proxy가 더 빠를 수도 있지만 서비스의 개수가 늘어나면 늘어날 수록 kube-proxy의 latency는 증가하는 반면 eBPF는 거의 동일한 결과를 보여주고 있다.\u003c/p\u003e\n\u003ch4\u003eCilium Feature\u003c/h4\u003e\n\u003cp\u003eCilium CNI를 고려한 가장 큰 이유는 Networking 방식인 iptables vs. eBPF의 차이로 인해 고려 중이었다. 또한 Cilium의 다양한 기능들도 이유에 포함되었다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOverlay Networking: 캡슐화 기반 가상 네트워크\u003c/li\u003e\n\u003cli\u003eNetwork monitoring: Hubble을 통해서 네트워크 모니터링 가능\u003c/li\u003e\n\u003cli\u003eMulti Cluster(Cluster Mesh): 하나의 k8s Cluster 내의 네트워크만이 아니라 Multi cluster간의 네트워크 통신을 손쉽게 관리할 수 있게 해준다.\u003c/li\u003e\n\u003cli\u003eIPAM: Cilium이 직접 Pod의 IP 할당을 담당하여 VPC 및 Subnet의 IP 부족 문제를 해결할 수 있다. -\u003e 이건 이전 포스팅의 \u003ca href=\"https://comstering.github.io/posts/eks-custom-networking\" rel=\"nofollow\" target=\"_blank\"\u003eEKS Custom Networking\u003c/a\u003e이 있어서 큰 메리트는 없었다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eHow to set Cilium in EKS?\u003c/h2\u003e\n\u003cp\u003eCilium CNI를 적용하겠다라고 의사결정을 한 이후 가장 큰 문제점은 EKS에 어떻게 적용하는 가였다. EKS에서는 이미 VPC CNI가 기본 설정이고 이 VPC CNI를 제거하는 순간 EKS내의 네트워크는 전부 마비가 된다. 또한 VPC CNI의 가장 큰 장점인 Pod의 IP가 VPC CIDR 내의 IP로 할당되어 AWS Resource와 direct 통신을 할 수 있는 장점도 없어지게 된다.\u003c/p\u003e\n\u003ch3\u003eSupport Cilium\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/eks-alternate-cni.png\" alt=\"eks-alternate-cni\"\u003e\u003c/p\u003e\n\u003cp\u003eAWS \u003ca href=\"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/alternate-cni-plugins.html\" rel=\"nofollow\" target=\"_blank\"\u003eEKS 문서\u003c/a\u003e에서 VPC CNI외에 사용할 수 있는 CNI가 명시되어 있다. 여기에는 Cilium이 포함되어 있다.\u003c/p\u003e\n\u003cp\u003e이 문서대로라면 EKS의 VPC CNI를 대체제로 Cilium CNI를 사용할 수 있다는 뜻이 된다.\u003c/p\u003e\n\u003ch3\u003eCilium CNI Chaining\u003c/h3\u003e\n\u003cp\u003eCilium CNI와 VPC CNI의 차이가 있고 당연히 VPC CNI가 가지고 있는 장점이 있다. 이러한 장점을 전부 버리면서 Cilium으로 넘어가야하는지는 물음표였다. 특히 VPC CNI의 Pod ENI IP 할당을 VPC CIDR Block으로 할당하여 VPC의 라우팅 테이블을 그대로 사용하면 LoadBalancer \u0026#x3C;-\u003e Pod와의 통신이 Node를 거치지 않고 Direct로 된다는 점, 당연하게 RDS, MSK 등 VPC 내에 설치된 인스턴스들과 Node를 거치지 않고 Pod IP에서 direct도 통신한다는 점에서 Cilium을 사용하는 네트워크 통신보다 더 빠른 Network Latency를 가질 것 같았다.\u003c/p\u003e\n\u003cp\u003e그러던 중 Cilium CNI 문서에서 \u003ca href=\"https://docs.cilium.io/en/stable/installation/cni-chaining/\" rel=\"nofollow\" target=\"_blank\"\u003eCNI Chaining\u003c/a\u003e이라는 문서를 확인했다. \u003ca href=\"https://docs.cilium.io/en/stable/installation/cni-chaining-aws-cni/\" rel=\"nofollow\" target=\"_blank\"\u003eAWS VPC CNI plugin 문서\u003c/a\u003e에서 VPC CNi와 Cilium CNI가 함께 사용하는 내용을 보여주었다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/aws-cni-chaining-1.png\" alt=\"aws-cni-chaining-1\"\u003e\n\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/aws-cni-chaining-2.png\" alt=\"aws-cni-chaining-2\"\u003e\u003c/p\u003e\n\u003cp\u003e두 이미지는 AWS VPC CNI와 Cilium을 Chaining 했을 때 각 CNI가 어떤 역할을 담당하는지 설명해주고 있다.\u003c/p\u003e\n\u003cp\u003e이것을 토대로 내 VPC에서 EKS Custom Networking을 적용한 Networking을 도식화하면 아래와 같은 결과가 나온다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/contents/introduce-cilium-cni/networking-structure.png\" alt=\"networking-structure\"\u003e\u003c/p\u003e\n\u003cp\u003eVPC CNI는 IPAM을 담당하여 Pod의 IP를 EKS Custom Networking 대역으로 할당한다.\u003c/p\u003e\n\u003cp\u003eVPC 외부로 통신하는 TGW, NAT Gateway로 통신할 때는 masquerade SNAT가 되어 Pod IP는 Node IP로 변환되어 통신한다.\u003c/p\u003e\n\u003cp\u003e외부에서 트래픽을 받을 때는 NLB 통해서 통신하게 되는데 이때 NLB와 Pod간 통신은 VPC CNI의 라우팅을 통해서 Node를 거치지 않고 Direct로 Pod와 통신하게 된다. 마찬가지로 Pod가 내부에 배포되어 있는 RDS, MSK 등과 통신하게 될 때는 Node IP를 통하지 않고 direct로 Pod IP와 통신하게 된다.\u003c/p\u003e\n\u003cp\u003e나머지 Kubernetes Networking은 전부 Cilium CNI가 담당하여 LoadBalancing, Security 등을 처리한다.\u003c/p\u003e\n\u003ch2\u003eFinished\u003c/h2\u003e\n\u003cp\u003eCilium CNI에 대해서 간단히 알아보고 내 EKS에 VPC CNI와 어떻게 잘 연결하여 사용할 수 있을지 알아보았다. 다음 포스팅에서는 위 내용을 토대로 내 EKS에 Cilium CNI를 설치하는 과정을 포스팅해보겠다.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"6:[\"$\",\"article\",null,{\"className\":\"max-w-3xl mx-auto\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-12 space-y-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"$Lf\",null,{\"href\":\"/\",\"className\":\"text-xs font-bold text-sky-500 flex items-center hover:gap-2 transition-all\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"className\":\"h-4 w-4 mr-2\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"stroke\":\"currentColor\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":2,\"d\":\"M15 19l-7-7 7-7\"}]}],\"BACK TO BLOG\"]}]}],[\"$\",\"div\",null,{\"className\":\"text-center space-y-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-5xl font-black text-gray-900 dark:text-white leading-tight\",\"children\":\"Cilium CNI 알아보기\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center gap-4 text-sm text-gray-500 font-medium\",\"children\":[[\"$\",\"span\",null,{\"children\":\"2025-08-31\"}],[\"$\",\"span\",null,{\"className\":\"w-1 h-1 bg-gray-300 rounded-full\"}],[\"$\",\"span\",null,{\"children\":\"6 min read\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"rounded-3xl overflow-hidden shadow-2xl shadow-sky-500/10 border border-gray-200 dark:border-gray-800 aspect-[21/9]\",\"children\":[\"$\",\"$L10\",null,{\"src\":\"/images/posts/thumbnails/cilium.png\",\"alt\":\"Cilium CNI 알아보기\",\"width\":840,\"height\":360,\"className\":\"w-full h-full object-cover\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"prose prose-lg dark:prose-invert max-w-none\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$11\"}}]}],[\"$\",\"div\",null,{\"className\":\"mt-16 pt-8 border-t border-card border-gray-100 dark:border-gray-800\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold text-foreground mb-6\",\"children\":\"Comments\"}],[\"$\",\"$L12\",null,{\"repo\":\"comstering/comstering.github.io\",\"repoId\":\"MDEwOlJlcG9zaXRvcnkzNjI0MjQ3NDk=\",\"category\":\"Announcements\",\"categoryId\":\"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyOTQ4OTYw\",\"mapping\":\"pathname\",\"strict\":\"0\",\"reactionsEnabled\":\"1\",\"emitMetadata\":\"0\",\"inputPosition\":\"top\",\"theme\":\"preferred_color_scheme\",\"lang\":\"ko\",\"loading\":\"lazy\"}]]}],[\"$\",\"footer\",null,{\"className\":\"mt-20 pt-10 border-t border-gray-100 dark:border-gray-800 flex flex-col items-center gap-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-4 p-6 bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 w-full\",\"children\":[[\"$\",\"$L10\",null,{\"src\":\"/profile.png\",\"width\":64,\"height\":64,\"className\":\"w-16 h-16 rounded-full object-cover border-2 border-sky-400\",\"alt\":\"Author\"}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"h4\",null,{\"className\":\"font-bold text-gray-900 dark:text-white\",\"children\":\"Written by Comstering\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":\"개발과 운영의 경계를 좁히는 클라우드 네이티브 엔지니어입니다.\"}]]}]]}],[\"$\",\"$Lf\",null,{\"href\":\"/\",\"className\":\"font-bold text-gray-900 dark:text-white hover:text-sky-500 transition-colors\",\"children\":\"모든 글 보기 →\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"9:null\nd:[[\"$\",\"title\",\"0\",{\"children\":\"Comstering's Dev Notes\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Comstering's personal development blog\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"Comstering, 개발 블로그, Dev Notes, Programming, Software Development\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"1024x1024\"}]]\n"])</script></body></html>